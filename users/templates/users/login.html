{% extends "users/base_no.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %}
<style>
        /* Custom styles for login page - keeping only login-specific styles */
        .login-form label {
            color: rgb(255, 255, 255) !important;
            font-size: 1.2rem !important;
            display: inline-block !important;
            text-align: right !important;
            padding-right: .5rem !important;
            width: 32% !important;
        }

        .login-form input {
            color: rgb(27, 118, 255) !important;
            background-color: rgb(255, 255, 255) !important;
            border: 2px solid rgb(126, 126, 126) !important;
            border-radius: 0.375rem !important;
            width: 35% !important;
            padding-left: .5rem !important;
            padding-right: .5rem !important;
            padding-top: 0.1rem !important;
            padding-bottom: 0.1rem !important;
            margin-top: 1rem !important;
        }

        .login-tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid #8a8a8a;
        }

        .login-tab {
            flex: 1;
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            color: #f3f3f3;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .login-tab.active {
            color: white;
            border-bottom-color: #0078d7;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .login-tab:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .login-content {
            display: none;
        }

        .login-content.active {
            display: block;
        }
    
</style>

<div class="min-h-screen flex items-start justify-center py-12 px-4 sm:px-6 lg:px-8 pt-8">
    <div class="max-w-2xl w-full space-y-8">
        <div class="login-box">
            <h2 class="mt-2 text-center text-3xl font-extrabold text-gray-100">Sign in to your account</h2>
            
            {% if auth_error %}
            <div class="auth-error">
                {{ auth_error }}
            </div>
            {% endif %}
            
            <!-- Login Method Tabs -->
            <div class="login-tabs">
                <button class="login-tab active" onclick="switchTab('microsoft')">Microsoft Login</button>
                <button class="login-tab" onclick="switchTab('password')">Username & Password</button>
            </div>
            
            <!-- Microsoft Login Content -->
            <div id="microsoft-content" class="login-content active">
                <a href="{{ microsoft_login_url }}" class="microsoft-button">
                    <img src="{% static 'users/img/ms-logo.svg' %}" alt="Microsoft logo" class="microsoft-logo">
                    Sign in with Microsoft
                </a>
                <div class="text-center mt-4">
                    <p class="text-sm text-gray-300">
                        Recommended for corporate accounts
                    </p>
                </div>
            </div>
            
            <!-- Username/Password Login Content -->
            <div id="password-content" class="login-content">
                <form class="login-form mt-4 space-y-6" method="POST">
                    {% csrf_token %}
                    <div class="rounded-md shadow-sm -space-y-px">
                        {{ form|crispy }}
                    </div>
                    <br>

                    <div>
                        <input type="hidden" name="password_login" value="1">
                        <button type="submit" class="btn-primary group relative w-1/2 mx-auto flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-gray-700 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                            Sign in with Password
                        </button>
                    </div>
                </form>
                <div class="text-center mt-4">
                    <p class="text-sm text-gray-300">
                        <a href="{% url 'users:custom_password_reset' %}" class="text-blue-300 hover:text-blue-200">Forgot your password?</a>
                    </p>
                </div>
            </div>
            
            <div class="text-center mt-6">
                <p class="text-sm text-gray-300">
                    Need an account? Contact your administrator.
                </p>
                <p class="text-sm text-gray-300 mt-2">
                    <a href="{% url 'users:oauth_migration' %}" class="text-blue-300 hover:text-blue-200 underline">
                        OAuth user? Set your password here
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    // Tab switching functionality
    function switchTab(tabName) {
        // Remove active class from all tabs and content
        document.querySelectorAll('.login-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.login-content').forEach(content => content.classList.remove('active'));
        
        // Add active class to selected tab and content
        document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
        document.getElementById(`${tabName}-content`).classList.add('active');
    }

    // Check for Microsoft authentication status
    document.addEventListener('DOMContentLoaded', function() {
        // Track authentication attempts in localStorage
        const authPending = localStorage.getItem('microsoft_auth_pending') === 'true';
        
        if (authPending) {
            // Clear the pending flag
            localStorage.removeItem('microsoft_auth_pending');
        }
        
        // Set up Microsoft login button to track auth state
        const msButton = document.querySelector('.microsoft-button');
        if (msButton) {
            msButton.addEventListener('click', function() {
                localStorage.setItem('microsoft_auth_pending', 'true');
            });
        }
    });
</script>
{% endblock content %} 