{% extends 'training/training_base.html' %}
{% load static %}

{% block body %}
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-6">Training Dashboard</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8">
            <div class="bg-white shadow-md rounded-lg p-6">
                <h2 class="text-xl font-medium mb-4">CMMC Training and Document Review Status</h2>
                <p class="text-gray-600 mb-2">You have completed {{ cmmc_courses_count }} out of {{ cmmc_total_courses_count }} total trainings.</p>
                <a href="{% url 'training:user_requirements' %}" class="inline-block px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300 mt-2">View Requirements</a>

                {% if is_staff %}
                    <div class="mt-4 border-t pt-4">
                        <h3 class="text-lg font-medium mb-2">Admin Actions</h3>
                        <a href="{% url 'training:training_audit' %}" class="inline-block px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-300 mt-2">View CMMC Audit Matrix</a>
                        <a href="{% url 'training:manage_matrix' %}" class="inline-block px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-300 mt-2">Manage Matrix</a>
                    </div>
                {% endif %}
                <div class="mt-4 border-t pt-4">
                    <h3 class="text-lg font-medium mb-2">Overall Training Status</h3>
                    <p class="text-gray-600 mt-2">Overall Completed: {{ total_completed_cmmc_trainings }} / {{ total_possible_cmmc_trainings }}</p>
                    <div class="flex justify-center mt-4" style="width: 300px; height: 300px;">
                        <canvas id="cmmcChart" width="200" height="200"></canvas>
                    </div>
                </div>
            </div>

            <div class="bg-white shadow-md rounded-lg p-6">
                <h2 class="text-xl font-medium mb-4">Arctic Wolf Security Awareness Training</h2>
                <p class="text-gray-600 mb-2">View and complete Arctic Wolf specific training courses.</p>
                <p class="text-gray-600 mb-2">You have completed {{ aw_completed_count }} out of {{ aw_total_courses_count }} Arctic Wolf trainings.</p>

                <a href="{% url 'training:user_arctic_wolf_courses' %}" class="inline-block px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300 mt-2">View My Courses</a>
                {% if is_staff %}
                    <div class="mt-4 border-t pt-4">
                        <h3 class="text-lg font-medium mb-2">Admin Actions</h3>
                        <a href="{% url 'training:add_arctic_wolf_course' %}" class="inline-block px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-300 mr-2">Add New Course</a>
                        <a href="{% url 'training:arctic_wolf_course_list' %}" class="inline-block px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-300 mr-2">View Course List</a>
                        <a href="{% url 'training:arctic_wolf_audit' %}" class="inline-block px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-300 mt-2">View AW Audit Matrix</a>
                    </div>
                {% endif %}
                <div class="mt-4 border-t pt-4">
                    <h3 class="text-lg font-medium mb-2">Overall Training Status</h3>
                    <p class="text-gray-600 mt-2">Overall Completed: {{ total_actual_aw_completions }} / {{ total_possible_aw_completions }}</p>
                    <div class="flex justify-center mt-4" style="width: 300px; height: 300px;">
                        <canvas id="arcticWolfChart" width="200" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // CMMC Chart
        const cmmcChartCtx = document.getElementById('cmmcChart').getContext('2d');
        const cmmcChart = new Chart(cmmcChartCtx, {
            type: 'pie',
            data: {
                labels: ['Completed', 'Uncompleted'],
                datasets: [{
                    data: ['{{ total_completed_cmmc_trainings }}', '{{ uncompleted_cmmc_trainings }}'],
                    backgroundColor: ['rgba(0, 127, 0, 0.8)', 'rgba(200, 0, 0, 0.8)'],
                    borderWidth: 1
                }]
            },
            options: {
                // Add any chart options here
            }
        });

        // Arctic Wolf Chart
        const arcticWolfChartCtx = document.getElementById('arcticWolfChart').getContext('2d');
        const arcticWolfChart = new Chart(arcticWolfChartCtx, {
            type: 'pie',
            data: {
                labels: ['Completed', 'Uncompleted'],
                datasets: [{
                    data: ['{{ total_actual_aw_completions }}', '{{ uncompleted_aw_completions }}'],
                    backgroundColor: ['rgba(0, 0, 250, 0.8)', 'rgba(200, 0, 0, 0.8)'],
                    borderWidth: 1
                }]
            },
            options: {
                // Add any chart options here
            }
        });
    </script>
{% endblock %}